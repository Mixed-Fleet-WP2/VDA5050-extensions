{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "state",
  "description": "all encompassing state of the elevator.",
  "subtopic": "/state",
  "type": "object",
  "required": [
    "headerId",
    "timestamp",
    "version",
    "manufacturer",
    "serialNumber",
    "orderId",
    "orderUpdateId",
    "lastNodeId",
    "lastNodeSequenceId",
    "nodeStates",
    "edgeStates",
    "transitioning",
    "actionStates",
    "operatingMode",
    "errors",
    "safetyState",
    "doorStatus"
  ],
  "properties": {
    "headerId": {
      "type": "integer",
      "description": "headerId of the message. The headerId is defined per topic and incremented by 1 with each sent (but not necessarily received) message."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp in ISO8601 format (YYYY-MM-DDTHH:mm:ss.ffZ).",
      "examples": [
        "1991-03-11T11:40:03.12Z"
      ]
    },
    "version": {
      "type": "string",
      "description": "Version of the protocol [Major].[Minor].[Patch]",
      "examples": [
        "1.3.2"
      ]
    },
    "manufacturer": {
      "type": "string",
      "description": "Manufacturer of the elevator"
    },
    "serialNumber": {
      "type": "string",
      "description": "Serial number of the elevator."
    },
    "maps": {
      "type": "array",
      "description": "Array of map-objects that are currently stored on the vehicle.",
      "items": {
        "type": "object",
        "title": "map",
        "required": [
          "mapId",
          "mapVersion",
          "mapStatus"
        ],
        "properties": {
          "mapId": {
            "type": "string",
            "description": "ID of the map describing a defined area of the vehicle's workspace."
          },
          "mapVersion": {
            "type": "string",
            "description": "Version of the map."
          },
          "mapDescription": {
            "type": "string",
            "description": "Additional information on the map."
          },
          "mapStatus": {
            "type": "string",
            "description": "Information on the status of the map indicating, if a map version is currently used by the elevator. ENABLED: Indicates this map is currently active / used on the elevator. At most one map with the same mapId can have its status set to ENABLED.<br>DISABLED: Indicates this map version is currently not enabled on the elevator and thus could be enabled or deleted by request.",
            "enum": [
              "ENABLED",
              "DISABLED"
            ]
          }
        }
      }
    },
    "orderId": {
      "type": "string",
      "description": "Unique order identification of the current order or the previous finished order. The orderId is kept until a new order is received. Empty string (\"\") if no previous orderId is available. "
    },
    "orderUpdateId": {
      "type": "integer",
      "description": "Order Update Identification to identify that an order update has been accepted by the elevator. \"0\" if no previous orderUpdateId is available."
    },
    "lastNodeId": {
      "type": "string",
      "description": "nodeID of last reached node or, if elevator is currently on a node, current node (e.g., \"node7\"). Empty string (\"\") if no lastNodeId is available."
    },
    "lastNodeSequenceId": {
      "type": "integer",
      "description": "sequenceId of the last reached node or, if the elevator is currently on a node, sequenceId of current node. \"0\" if no lastNodeSequenceId is available. "
    },
    "transitioning": {
      "type": "boolean",
      "description": "True: indicates that the elevator is in the process of moving between floors. False: indicates that the elevator is stationary at a floor."
    },
    "paused": {
      "type": "boolean",
      "description": "True: elevator is currently in a paused state, either because of the push of a physical button on the elevator or because of an instantAction. The elevator can resume the order.\nFalse: The elevator is currently not in a paused state."
    },
    "newBaseRequest": {
      "type": "boolean",
      "description": "True: Elevator is almost at the end of the base and will stop at the last base floor if new base is not received. Trigger for master control to send new base\nFalse: no base update required."
    },
    "distanceSinceLastNode": {
      "type": "number",
      "description": "Used by line guided vehicles to indicate the distance it has been driving past the \"lastNodeId\".\nDistance is in meters."
    },
    "operatingMode": {
      "type": "string",
      "description": "Current operating mode of the elevator.",
      "enum": [
        "AUTOMATIC",
        "SERVICE",
        "LOCAL_CONTROL",
        "DUAL"
      ]
    },
    "nodeStates": {
      "type": "array",
      "description": "Array of nodeState-Objects, that need to be traversed for fulfilling the order. Empty list if idle.",
      "items": {
        "type": "object",
        "title": "nodeState",
        "required": [
          "nodeId",
          "sequenceId",
          "released"
        ],
        "properties": {
          "nodeId": {
            "type": "string",
            "description": "Unique node identification"
          },
          "sequenceId": {
            "type": "integer",
            "description": "sequenceId to discern multiple nodes with same nodeId."
          },
          "nodeDescription": {
            "type": "string",
            "description": "Additional information on the node."
          },
          "released": {
            "type": "boolean",
            "description": "True: indicates that the node is part of the base. False: indicates that the node is part of the horizon."
          }
        }
      }
    },
    "edgeStates": {
      "type": "array",
      "description": "Array of edgeState-Objects, that need to be traversed for fulfilling the order, empty list if idle.",
      "items": {
        "type": "object",
        "required": [
          "edgeId",
          "sequenceId",
          "released"
        ],
        "properties": {
          "edgeId": {
            "type": "string",
            "description": "Unique edge identification"
          },
          "sequenceId": {
            "type": "integer",
            "description": "sequenceId of the edge."
          },
          "edgeDescription": {
            "type": "string",
            "description": "Additional information on the edge."
          },
          "released": {
            "type": "boolean",
            "description": "True indicates that the edge is part of the base. False indicates that the edge is part of the horizon."
          }
        }
      }
    },
    "actionStates": {
      "type": "array",
      "description": "Contains a list of the current actions and the actions which are yet to be finished. This may include actions from previous nodes that are still in progress\nWhen an action is completed, an updated state message is published with actionStatus set to finished and if applicable with the corresponding resultDescription. The actionStates are kept until a new order is received.",
      "items": {
        "type": "object",
        "required": [
          "actionId",
          "actionStatus"
        ],
        "title": "actionState",
        "properties": {
          "actionId": {
            "type": "string",
            "description": "Unique actionId",
            "examples": [
              "blink_123jdaimoim234"
            ]
          },
          "actionType": {
            "type": "string",
            "description": "actionType of the action.\nOptional: Only for informational or visualization purposes. Order knows the type."
          },
          "actionDescription": {
            "type": "string",
            "description": "Additional information on the current action."
          },
          "actionStatus": {
            "type": "string",
            "description": "WAITING: waiting for the trigger (e.g. waiting for a button press) PAUSED: paused by instantAction or external trigger FAILED: action could not be performed.",
            "enum": [
              "WAITING",
              "INITIALIZING",
              "RUNNING",
              "FINISHED",
              "FAILED"
            ]
          },
          "resultDescription": {
            "type": "string",
            "description": "Description of the result, e.g., the result of a RFID-read. Errors will be transmitted in errors."
          }
        }
      }
    },
    "errors": {
      "type": "array",
      "description": "Array of error-objects. All active errors of the elevator should be in the list. An empty array indicates that the elevator has no active errors.",
      "items": {
        "type": "object",
        "required": [
          "errorType",
          "errorLevel"
        ],
        "title": "Error",
        "properties": {
          "errorType": {
            "type": "string",
            "description": "Type/name of error."
          },
          "errorReferences": {
            "type": "array",
            "items": {
              "type": "object",
              "title": "errorReference",
              "description": "Array of references (e.g. nodeId, edgeId, orderId, actionId, etc.) to provide more information related to the error.",
              "properties": {
                "referenceKey": {
                  "type": "string",
                  "description": "Specifies the type of reference used (e.g. nodeId, edgeId, orderId, actionId, etc.)."
                },
                "referenceValue": {
                  "type": "string",
                  "description": "The value that belongs to the reference key. For example, the id of the node where the error occurred."
                }
              },
              "required": [
                "referenceKey",
                "referenceValue"
              ]
            }
          },
          "errorDescription": {
            "type": "string",
            "description": "Verbose description providing details and possible causes of the error."
          },
          "errorHint": {
            "type": "string",
            "description": "Hint on how to approach or solve the reported error."
          },
          "errorLevel": {
            "type": "string",
            "description": "WARNING: elevator is ready to operate (e.g., maintenance cycle expiration warning). FATAL: elevator is not in running condition, user intervention required (e.g. issue with the motor).",
            "enum": [
              "WARNING",
              "FATAL"
            ]
          }
        }
      }
    },
    "information": {
      "type": "array",
      "description": "Array of info-objects. An empty array indicates, that the elevator has no information. This should only be used for visualization or debugging â€“ it must not be used for logic in master control.",
      "items": {
        "type": "object",
        "required": [
          "infoType",
          "infoLevel"
        ],
        "properties": {
          "infoType": {
            "type": "string",
            "description": "Type/name of information."
          },
          "infoReferences": {
            "type": "array",
            "items": {
              "type": "object",
              "required": [
                "referenceKey",
                "referenceValue"
              ],
              "title": "infoReference",
              "description": "Array of references.",
              "properties": {
                "referenceKey": {
                  "type": "string",
                  "description": "References the type of reference (e.g., headerId, orderId, actionId, etc.)."
                },
                "referenceValue": {
                  "type": "string",
                  "description": "References the value, which belongs to the reference key."
                }
              }
            }
          },
          "infoDescription": {
            "type": "string",
            "description": "Info of description."
          },
          "infoLevel": {
            "type": "string",
            "description": "DEBUG: used for debugging. INFO: used for visualization.",
            "enum": [
              "INFO",
              "DEBUG"
            ]
          }
        }
      }
    },
    "safetyState": {
      "type": "object",
      "required": [
        "eStop"
      ],
      "description": "Contains all safety-related information.",
      "properties": {
        "eStop": {
          "type": "string",
          "description": "Acknowledge-Type of eStop: AUTOACK: auto-acknowledgeable e-stop is activated, e.g., something is blocking the doors. MANUAL: e-stop hast to be acknowledged manually at the vehicle. REMOTE: facility e-stop has to be acknowledged remotely. NONE: no e-stop activated.",
          "enum": [
            "AUTOACK",
            "MANUAL",
            "REMOTE",
            "NONE"
          ]
        }
      }
    },
    "doorStatus": {
      "type": "object",
      "properties": {
        "openingInProgress": {
          "type": "boolean",
          "description": "Indicates whether the elevator's doors are fully opened. Complements doorsOpening. "
        },
        "open": {
          "type": "boolean",
          "description": "Indicates whether the elevator's doors are fully opened. Complements doorsOpening."
        }
      },
      "required": [
        "openingInProgress",
        "open"
      ]
    }
  }
}